var child_process = require('child_process');
var path = require('path');
var ftpPath = path.resolve(__dirname, "./soft/ftp/filezilla.exe");
var puttyPath = path.resolve(__dirname, "./bin/PUTTY.exe");
var plinkPath = path.resolve(__dirname, "./bin/PLINK.exe");
var shPath = path.resolve(__dirname, "./sh");
var setting = require('./setting.js');

function ftp(server) {
	child_process.spawn(ftpPath, ["-c", "0" + server])
}

function putty(server) {
	var usr = setting.get("ssh:" + server + ":usr");
	var pwd = setting.get("ssh:" + server + ":usr_pwd");
	var ip = setting.get("ip:" + server);
	var cmdStr = `"${puttyPath}" -pw ${pwd} ${usr}@${ip}`;
	child_process.exec(cmdStr);
}

function copy(str) {
	child_process.exec("echo " + str + "|clip");
}

function plink(opt, out, error) {
	var server = opt["server"];
	var cmd = opt["cmd"];
	var cmdFile = opt["cmdFile"];
	var root = opt["root"];
	var usr, pwd, cmdStr;
	if (root) {
		usr = setting.get("ssh:" + server + ":root");
		pwd = setting.get("ssh:" + server + ":root_pwd");
	} else {
		usr = setting.get("ssh:" + server + ":usr");
		pwd = setting.get("ssh:" + server + ":usr_pwd");
	}
	var ip = setting.get("ip:" + server);
	if (cmdFile) {
		cmdStr = `"${plinkPath}" -m "${path.resolve(shPath,cmdFile)}" -pw ${pwd} ${usr}@${ip}`;
	} else {
		cmdStr = `"${plinkPath}" -pw ${pwd} ${usr}@${ip} "${cmd}"`;
	}
	var cp = child_process.exec(cmdStr, function(err, stdout, stderr) {
		if (err) {
			if (error) error(err);
		} else {
			if (out) out(stdout);
			if (error) error(stderr);
		}
	});
}

function mailto(url) {
	var cmd = `start notes "mailto:${url}"`;
	child_process.exec(cmd); 
}

module.exports.ftp = ftp;
module.exports.copy = copy;
module.exports.putty = putty;
module.exports.plink = plink;
module.exports.mailto = mailto;